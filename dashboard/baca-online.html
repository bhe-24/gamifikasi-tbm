<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Pustaka Digital</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Poppins', sans-serif; background-color: #F3E5F5; padding-bottom: 60px; }
        
        .page-header {
            background: linear-gradient(135deg, #CE93D8, #AB47BC); /* Ungu Gradasi */
            padding: 15px 20px; display: flex; align-items: center; justify-content: space-between;
            position: sticky; top: 0; z-index: 100; color: white;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1); border-bottom-left-radius: 20px; border-bottom-right-radius: 20px;
        }

        .search-box { margin: 20px; position: relative; }
        .search-input { width: 100%; border-radius: 25px; border: none; padding: 12px 20px 12px 45px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        .search-icon { position: absolute; left: 15px; top: 50%; transform: translateY(-50%); color: #aaa; }

        /* KATEGORI RAPI */
        .category-section { margin-bottom: 25px; padding-left: 20px; }
        .cat-title { font-weight: 700; color: #6A1B9A; margin-bottom: 10px; border-left: 4px solid #AB47BC; padding-left: 10px; }

        .book-scroller { display: flex; overflow-x: auto; gap: 15px; padding-bottom: 15px; padding-right: 20px; scrollbar-width: none; }
        .book-scroller::-webkit-scrollbar { display: none; }

        /* KARTU BUKU STABIL */
        .book-card {
            min-width: 130px; width: 130px; /* Lebar Kunci */
            display: flex; flex-direction: column; cursor: pointer;
        }
        .book-cover {
            width: 100%; height: 190px; /* Tinggi Kunci */
            border-radius: 10px; object-fit: cover;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1); margin-bottom: 8px; background: #ddd;
        }
        .book-title {
            font-size: 0.85rem; font-weight: 600; color: #333; line-height: 1.2;
            display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; /* Potong teks kalau kepanjangan */
            height: 2.4em; /* Tinggi pas 2 baris */
        }
        .book-author { font-size: 0.75rem; color: #888; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    </style>
</head>
<body>
    <div class="page-header">
        <i class="fas fa-arrow-left" onclick="window.location.href='index.html'" style="font-size:1.2rem; cursor:pointer;"></i>
        <span style="font-weight:700;">Baca Online</span>
        <img src="https://i.ibb.co.com/m50m25d/image-removebg-preview-13.png" style="width:35px; background:white; border-radius:50%; padding:2px;">
    </div>

    <div style="margin:20px; border-radius:15px; overflow:hidden; box-shadow:0 4px 10px rgba(0,0,0,0.05);">
        <img src="https://placehold.co/600x200/CE93D8/ffffff?text=Pustaka+Digital" id="bannerImg" style="width:100%; display:block;">
    </div>

    <div class="search-box">
        <i class="fas fa-search search-icon"></i>
        <input type="text" id="searchInput" class="search-input" placeholder="Cari buku...">
    </div>

    <div id="contentArea">
        <div class="text-center p-5 text-muted"><i class="fas fa-spinner fa-spin"></i> Memuat pustaka...</div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBRGNL4DL5L_x92vv6tI4Ysa9Q0qyKvjeQ",
            authDomain: "pkm-pm-def08.firebaseapp.com",
            databaseURL: "https://pkm-pm-def08-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "pkm-pm-def08",
            storageBucket: "pkm-pm-def08.firebasestorage.app",
            messagingSenderId: "1077227616889",
            appId: "1:1077227616889:web:9ce3a57e3d46012acab2a8"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        let allBooks = [];

        // Load Settings
        onValue(ref(db, 'settings'), snap => {
            if(snap.val() && snap.val().bannerBacaUrl) document.getElementById('bannerImg').src = snap.val().bannerBacaUrl;
        });

        // Load Books
        onValue(ref(db, 'books'), snap => {
            const container = document.getElementById('contentArea');
            if(!snap.exists()) { container.innerHTML = '<div class="text-center p-5 text-muted">Belum ada buku.</div>'; return; }
            
            allBooks = [];
            snap.forEach(c => allBooks.push({id:c.key, ...c.val()}));
            renderBooks(allBooks);
        });

        function renderBooks(books) {
            const container = document.getElementById('contentArea');
            container.innerHTML = '';
            
            // Grouping
            const cats = {};
            books.forEach(b => {
                const c = b.category || "Umum";
                if(!cats[c]) cats[c] = [];
                cats[c].push(b);
            });

            Object.keys(cats).forEach(cat => {
                let items = '';
                cats[cat].forEach(b => {
                    items += `
                        <div class="book-card" onclick="window.location.href='preview-buku.html?id=${b.id}'">
                            <img src="${b.coverUrl}" class="book-cover" onerror="this.src='https://placehold.co/130x190?text=No+Cover'">
                            <div class="book-title">${b.title}</div>
                            <div class="book-author">${b.author}</div>
                        </div>
                    `;
                });
                container.innerHTML += `
                    <div class="category-section">
                        <div class="cat-title">${cat}</div>
                        <div class="book-scroller">${items}</div>
                    </div>
                `;
            });
        }

        document.getElementById('searchInput').addEventListener('input', (e) => {
            const key = e.target.value.toLowerCase();
            const filtered = allBooks.filter(b => b.title.toLowerCase().includes(key) || b.author.toLowerCase().includes(key));
            renderBooks(filtered);
        });
    </script>
</body>
</html>
