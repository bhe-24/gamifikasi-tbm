<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Pustaka Digital - TBM</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --theme-color: #D8BFD8; /* Lilac Pastel */
            --theme-dark: #9F82A0;
            --bg-color: #F8F5F8;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--bg-color);
            padding-bottom: 50px;
        }

        /* HEADER KHAS LILAC */
        .page-header {
            background-color: var(--theme-color);
            padding: 15px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            border-bottom-left-radius: 15px;
            border-bottom-right-radius: 15px;
        }

        .back-btn { color: white; font-size: 1.2rem; cursor: pointer; }
        .page-title { color: white; font-weight: 700; font-size: 1.1rem; }
        .header-logo { width: 35px; height: 35px; background: white; border-radius: 50%; padding: 2px; object-fit: contain;}

        /* BANNER */
        .promo-banner {
            margin: 20px;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            min-height: 120px;
            background: #eee;
        }
        .promo-banner img { width: 100%; height: auto; display: block; }

        /* SEARCH BAR */
        .search-container {
            margin: 0 20px 20px 20px;
        }
        .search-input {
            border-radius: 20px;
            border: 2px solid var(--theme-color);
            padding: 10px 20px;
            width: 100%;
            outline: none;
        }

        /* KATEGORI & BUKU */
        .category-section { margin-bottom: 30px; padding-left: 20px; }
        .cat-title {
            font-size: 1rem;
            font-weight: 700;
            color: #555;
            margin-bottom: 15px;
            border-left: 4px solid var(--theme-color);
            padding-left: 10px;
        }

        /* Horizontal Scroll untuk Buku */
        .book-scroller {
            display: flex;
            overflow-x: auto;
            gap: 15px;
            padding-bottom: 10px;
            padding-right: 20px;
            scrollbar-width: none; /* Hide scrollbar Firefox */
        }
        .book-scroller::-webkit-scrollbar { display: none; } /* Hide Chrome */

        .book-card {
            min-width: 120px;
            width: 120px;
            background: transparent;
            cursor: pointer;
            transition: transform 0.2s;
        }
        .book-card:active { transform: scale(0.95); }

        .book-cover {
            width: 100%;
            height: 170px;
            border-radius: 10px;
            object-fit: cover;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            margin-bottom: 8px;
        }
        .book-title {
            font-size: 0.85rem;
            font-weight: 600;
            color: #333;
            line-height: 1.2;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        .book-author { font-size: 0.7rem; color: #888; }
        
        /* FOOTER */
        .footer-text { text-align: center; font-size: 0.7rem; color: #aaa; margin-top: 40px; }
    </style>
</head>
<body>

    <div class="page-header">
        <div onclick="history.back()" class="back-btn"><i class="fas fa-arrow-left"></i></div>
        <div class="page-title">Pustaka Digital</div>
        <img src="https://i.ibb.co.com/m50m25d/image-removebg-preview-13.png" id="logoHeader" class="header-logo">
    </div>

    <div class="promo-banner">
        <img src="https://placehold.co/600x200/D8BFD8/ffffff?text=Koleksi+Buku+Baru!" id="bannerBuku">
    </div>

    <div class="search-container">
        <input type="text" id="searchInput" class="search-input" placeholder="Cari judul buku atau penulis...">
    </div>

    <div id="mainContent">
        <div class="text-center p-5 text-muted">
            <i class="fas fa-spinner fa-spin fa-2x"></i><br>Mengambil data buku...
        </div>
    </div>

    <div class="footer-text">&copy; 2026 TBM Digital</div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBRGNL4DL5L_x92vv6tI4Ysa9Q0qyKvjeQ",
            authDomain: "pkm-pm-def08.firebaseapp.com",
            projectId: "pkm-pm-def08",
            storageBucket: "pkm-pm-def08.firebasestorage.app",
            messagingSenderId: "1077227616889",
            appId: "1:1077227616889:web:9ce3a57e3d46012acab2a8"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // 1. Load Settings (Logo & Banner)
        onValue(ref(db, 'settings'), (snap) => {
            const data = snap.val();
            if(data) {
                if(data.logoUrl) document.getElementById('logoHeader').src = data.logoUrl;
                if(data.bannerBacaUrl) document.getElementById('bannerBuku').src = data.bannerBacaUrl;
            }
        });

        // 2. Load Buku & Grouping Kategori
        const booksRef = ref(db, 'books');
        let allBooks = []; // Simpan lokal untuk pencarian

        onValue(booksRef, (snapshot) => {
            const contentDiv = document.getElementById('mainContent');
            contentDiv.innerHTML = '';
            
            if (!snapshot.exists()) {
                contentDiv.innerHTML = '<div class="text-center mt-5">Belum ada buku tersedia.</div>';
                return;
            }

            allBooks = [];
            const categories = {}; // Object untuk grouping: { "Anak": [buku1, buku2], "Novel": [buku3] }

            // A. Ambil Data & Grouping
            snapshot.forEach((child) => {
                const book = { id: child.key, ...child.val() };
                allBooks.push(book);

                const catName = book.category || "Lainnya";
                if (!categories[catName]) categories[catName] = [];
                categories[catName].push(book);
            });

            // B. Render per Kategori
            // Tips: Kita bisa urutkan dulu "Populer" atau "Terbaru" jika mau logic tambahan
            
            Object.keys(categories).forEach(cat => {
                const booksInCat = categories[cat];
                
                // Buat Section HTML
                let booksHtml = '';
                booksInCat.forEach(b => {
                    booksHtml += `
                        <div class="book-card" onclick="window.location.href='preview-buku.html?id=${b.id}'">
                            <img src="${b.coverUrl}" class="book-cover" onerror="this.src='https://placehold.co/120x170?text=No+Cover'">
                            <div class="book-title">${b.title}</div>
                            <div class="book-author">${b.author}</div>
                        </div>
                    `;
                });

                const sectionHtml = `
                    <div class="category-section">
                        <div class="cat-title">${cat}</div>
                        <div class="book-scroller">
                            ${booksHtml}
                        </div>
                    </div>
                `;
                contentDiv.innerHTML += sectionHtml;
            });
        });

        // 3. Fitur Search Sederhana
        document.getElementById('searchInput').addEventListener('input', (e) => {
            const keyword = e.target.value.toLowerCase();
            const cards = document.querySelectorAll('.book-card');
            
            // Loop DOM elements (Cara simpel visual)
            // Catatan: Jika ingin search real-time menghilangkan kategori, logicnya harus render ulang HTML.
            // Untuk prototype, kita pakai filter opacity saja biar mudah.
            cards.forEach(card => {
                const title = card.querySelector('.book-title').innerText.toLowerCase();
                const author = card.querySelector('.book-author').innerText.toLowerCase();
                if(title.includes(keyword) || author.includes(keyword)) {
                    card.style.display = "block";
                } else {
                    card.style.display = "none";
                }
            });
        });

    </script>
</body>
</html>
